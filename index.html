<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calendar (Dark Mode with Current Year Progress)</title>

  <style>
    body {
      font-family: monospace;
      background-color: #000;
      color: #fff;
    }

    .wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      min-height: 100%;
    }

    #calendar {
      margin: 0 auto;
      font-size: 14px;
    }

    table {
      border-collapse: collapse;
      table-layout: fixed;
      position: relative;
      background-color: #000;
      border: 2px solid #fff;
      box-shadow: 2px 2px 1px 0px #fff;
      border-radius: 5px;
      transition: opacity 0.25s ease;
      opacity: 0;
    }

    table.actiu {
      opacity: 1;
    }

    .month {
      background-color: #000;
      color: #fff;
      font-size: 1.5em;
      position: relative;
      border-bottom: 1px solid #fff;
    }

    .year {
      font-size: 12px;
      font-weight: normal;
      display: block;
      color: #fff;
      margin-top: 5px;
    }

    /* Year progress bar container */
    .year-progress {
      width: 80%;
      height: 6px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
      margin: 5px auto 0 auto;
      overflow: hidden;
    }

    .year-progress-bar {
      height: 100%;
      background: #fff;
      border-radius: 3px;
      width: 0%;
      transition: width 0.3s ease;
    }

    .year-progress-text {
      text-align: center;
      font-size: 10px;
      color: #fff;
      margin-top: 3px;
    }

    .day-header {
      background-color: #111;
    }

    td,
    th {
      text-align: center;
      background-color: #000;
      color: #fff;
    }

    th {
      padding: 10px;
    }

    td {
      padding: 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    td > span {
      color: #fff;
      padding: 10px;
      display: block;
      border: 2px solid transparent;
      transition: border 0.3s ease, background 0.3s ease;
    }

    td > span:hover {
      border-color: #fff;
      background-color: rgba(255, 255, 255, 0.1);
    }

    td.avui > span {
      font-weight: bold;
      background-color: #fff;
      color: #000;
    }

    td.fora > span {
      opacity: 0.2;
    }

    .boto-next,
    .boto-prev {
      background: transparent;
      color: #fff;
      font-family: inherit;
      border: none;
      font-size: 25px;
      font-weight: bold;
      padding: 2px 10px 5px 10px;
      line-height: 1px;
      height: 30px;
      width: 30px;
      vertical-align: middle;
      position: absolute;
      top: 15px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .boto-next:hover,
    .boto-prev:hover {
      transform: scale(1.2);
    }

    .boto-next {
      right: 10px;
      padding-left: 13px;
    }

    .boto-prev {
      left: 10px;
      padding-right: 13px;
    }
  </style>
</head>
<body>
  <div id="calendar"></div>

  <script>
    const months = [
      "January","February","March","April","May","June",
      "July","August","September","October","November","December"
    ];

    const days_abr = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"];

    Number.prototype.pad = function (num) {
      let str = "";
      for (let i = 0; i < num - this.toString().length; i++) str += "0";
      return (str += this.toString());
    };

    function calendar(widget, data) {
      widget.innerHTML = ""; // Clear immediately to prevent flicker

      const e = document.createElement("table");
      e.className = "actiu";
      widget.appendChild(e);

      e.setAttribute(
        "data-actual",
        data.getFullYear() +
          "/" +
          data.getMonth().pad(2) +
          "/" +
          data.getDate().pad(2)
      );

      // Month + Year header
      let fila = document.createElement("tr");
      let titol = document.createElement("th");
      titol.setAttribute("colspan", 7);
      titol.setAttribute("class", "month");

      const boto_prev = document.createElement("button");
      boto_prev.className = "boto-prev";
      boto_prev.innerHTML = "&#9666;";

      const boto_next = document.createElement("button");
      boto_next.className = "boto-next";
      boto_next.innerHTML = "&#9656;";

      titol.appendChild(boto_prev);

      const titleSpan = document.createElement("span");
      titleSpan.innerHTML =
        months[data.getMonth()] +
        '<span class="year">' +
        data.getFullYear() +
        "</span>";
      titol.appendChild(titleSpan);

      // --- CURRENT YEAR PROGRESS ---
      const now = new Date();
      const currentYear = now.getFullYear();
      const start = new Date(currentYear, 0, 1);
      const end = new Date(currentYear + 1, 0, 1);
      const progress = ((now - start) / (end - start)) * 100;

      const progressContainer = document.createElement("div");
      progressContainer.className = "year-progress";
      const progressBar = document.createElement("div");
      progressBar.className = "year-progress-bar";
      progressBar.style.width = progress.toFixed(1) + "%";
      progressContainer.appendChild(progressBar);

      const progressText = document.createElement("div");
      progressText.className = "year-progress-text";
      progressText.textContent =
        progress.toFixed(1) + "% of " + currentYear + " completed";

      titol.appendChild(progressContainer);
      titol.appendChild(progressText);

      titol.appendChild(boto_next);
      fila.appendChild(titol);
      e.appendChild(fila);

      boto_prev.onclick = function () {
        data.setMonth(data.getMonth() - 1);
        calendar(widget, data);
      };

      boto_next.onclick = function () {
        data.setMonth(data.getMonth() + 1);
        calendar(widget, data);
      };

      // Days of the week header
      fila = document.createElement("tr");
      for (let i = 1; i < 7; i++) {
        fila.innerHTML += '<th class="day-header">' + days_abr[i] + "</th>";
      }
      fila.innerHTML += '<th class="day-header">' + days_abr[0] + "</th>";
      e.appendChild(fila);

      const inici_mes = new Date(data.getFullYear(), data.getMonth(), -1).getDay();
      const actual = new Date(data.getFullYear(), data.getMonth(), -inici_mes);

      // Build days grid
      for (let s = 0; s < 6; s++) {
        let fila = document.createElement("tr");
        for (let d = 1; d < 8; d++) {
          let cela = document.createElement("td");
          let span = document.createElement("span");
          cela.appendChild(span);
          span.innerHTML = actual.getDate();

          if (actual.getMonth() !== data.getMonth()) cela.className = "fora";

          if (
            now.getDate() == actual.getDate() &&
            now.getMonth() == actual.getMonth() &&
            now.getFullYear() == actual.getFullYear()
          )
            cela.className = "avui";

          actual.setDate(actual.getDate() + 1);
          fila.appendChild(cela);
        }
        e.appendChild(fila);
      }

      // Fade-in for smooth appearance
      requestAnimationFrame(() => (e.style.opacity = 1));
    }

    calendar(document.getElementById("calendar"), new Date());
  </script>
</body>
</html>
